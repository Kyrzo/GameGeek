<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>GeekHubs Hackathon!!!!</title>
    <script src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(968,544, Phaser.AUTO, '', { preload: preload, create: create, update: update });

var player, player1;
var platforms;
var objetosRandom;

var cursors;
var stars;
var keyA, keyD, keyW , keyR;


//vidas
//var vidaRecogida = false;
var life;
var cactus;

var objetoRecogido = false;
var velocityLeft = -150;
var velocityRight = 150;

//pollos
//var pollosRecogido = false;
var pollo;

//Tiro
var bullets;
var bullet;
var bulletTime = 0;

var bullets1;
var bullet1;
var bulletTime1 = 0;

var direccion = 0;

function preload() {

	//Cargamos los assets
 	
    game.load.image('back0', 'assets/mapa1_capafondo.png');
    game.load.image('back1', 'assets/mapa1_capajuego.png');
    game.load.image('ground', 'assets/ground.png');
    game.load.image('star', 'assets/star.png');
    game.load.image('vida', 'assets/firstaid.png')
    game.load.spritesheet('dude', 'assets/dude.png', 32, 48);
    game.load.spritesheet('objetos', 'assets/cactushologram.png', 38, 48);
    game.load.spritesheet('chicken', 'assets/gallina.png', 38, 48);
    //game.load.image('pollos', 'assets/diamond.png')
	game.load.image('bala','assets/bala.png');

}

function create() {

    var stats = 70;



    //Genera vidas
    game.time.events.repeat(5000, 25, createObject, this);

    //Genera pollos
    //game.time.events.repeat(5000, 10, createPollo, this);

	//Cargamos las fisicas arcade para nuestro videojuego
	game.physics.startSystem(Phaser.Physics.ARCADE);

    //Añadimos el sprite de fondo
    //game.add.sprite(0, 0, 'sky');
    var back0 = game.add.sprite(0, 0, 'back0');
    back0.scale.setTo(2,2);
    var back1 = game.add.sprite(0, 0, 'back1');
    back1.scale.setTo(2,2);

    //Creamos el grupo de plataformas
    platforms = game.add.group();

    //Le damos propiedades de cuerpo al grupo plataformas
    platforms.enableBody = true;

    objetosRandom = game.add.group();

    objetosRandom.enableBody = true;
    // Creamos la variable ground que contendrá las plataformas.
    var ground = platforms.create(0, game.world.height - 80, 'ground');

    // Escalamos el original
    ground.scale.setTo(968, 80);

    // Hacemos que no se pueda mover para que no caiga y se mantenga fijo
    ground.body.immovable = true;


    //  Creamos 7 plataformas
    var ledge = platforms.create(0, 122, 'ground');
    ledge.body.immovable = true;
    ledge.scale.setTo(132,10);

    var ledge2 = platforms.create(0, 356, 'ground');
    ledge2.body.immovable = true;
    ledge2.scale.setTo(238,10);

    var ledge3 = platforms.create(236, 226, 'ground');
    ledge3.body.immovable = true;
    ledge3.scale.setTo(496,10);

    var ledge4 = platforms.create(game.world.width - 132, 122, 'ground');
    ledge4.body.immovable = true;
    ledge4.scale.setTo(132,10);

    var ledge5 = platforms.create(game.world.width - 238, 356, 'ground');
    ledge5.body.immovable = true;
    ledge5.scale.setTo(238,10);

    var ledge6 = platforms.create(478, 0, 'ground');
    ledge6.body.immovable = true;
    ledge6.scale.setTo(12,122);

    var ledge7 = platforms.create(478, game.world.height - (122 + stats), 'ground');
    ledge7.body.immovable = true;
    ledge7.scale.setTo(12,122);

    //Creamos al personaje jugador
    player = game.add.sprite(32, game.world.height - 200, 'dude');
    player1 = game.add.sprite(64, game.world.height - 400, 'dude');

    //Creamos las fisicas del personaje
    game.physics.arcade.enable(player);
    game.physics.arcade.enable(player1);
    

 

    // Caracteristicas fisicas del personaje
    player.body.bounce.y = 0.2;
    player.body.gravity.y = 300;
    player.body.collideWorldBounds = true;

    player1.body.bounce.y = 0.2;
    player1.body.gravity.y = 300;
    player1.body.collideWorldBounds = true;

    //  Animaciones.
    player.animations.add('left', [0, 1, 2, 3], 10, true);
    player.animations.add('right', [5, 6, 7, 8], 10, true);

    player1.animations.add('left', [0, 1, 2, 3], 10, true);
    player1.animations.add('right', [5, 6, 7, 8], 10, true);

    

    //Controles por teclado
     cursors = game.input.keyboard.createCursorKeys();
     keyA = game.input.keyboard.addKey(Phaser.Keyboard.A);
     keyD = game.input.keyboard.addKey(Phaser.Keyboard.D);
     keyW = game.input.keyboard.addKey(Phaser.Keyboard.W);
     keyR = game.input.keyboard.addKey(Phaser.Keyboard.R);

	 game.input.keyboard.addKeyCapture([ Phaser.Keyboard.SPACEBAR ]);
      game.input.keyboard.addKeyCapture([ Phaser.Keyboard.X ]);
   
	 /* Balas */
	
	bullets = game.add.group();
    bullets.enableBody = true;
    bullets.physicsBodyType = Phaser.Physics.ARCADE;
	 bullets.createMultiple(30, 'bala');

     bullets1 = game.add.group();
    bullets1.enableBody = true;
    bullets1.physicsBodyType = Phaser.Physics.ARCADE;
     bullets1.createMultiple(30, 'bala');
}

function update() {

	 //  Colisiones de jugador y plataformas
    game.physics.arcade.collide(player, platforms);
    game.physics.arcade.collide(life, platforms);
    game.physics.arcade.collide(pollo, platforms);
    game.physics.arcade.collide(player1, platforms);
    game.physics.arcade.collide(player,player1);
    

	player.body.checkCollision.up = false;
    player1.body.checkCollision.up = false;
	//game.physics.arcade.collide(bullets, platforms);
	
	game.physics.arcade.collide(bullets, platforms,destroyBullet);
    game.physics.arcade.collide(bullets1, platforms,destroyBullet);

    game.physics.arcade.overlap(player, life, collectLife, null, this);
    game.physics.arcade.overlap(player, pollo, collectPollo, null, this);
    game.physics.arcade.overlap(player, cactus, collectCactus, null, this);
    game.physics.arcade.overlap(player1, life, collectLife, null, this);
    game.physics.arcade.overlap(player1, pollo, collectPollo, null, this);
    game.physics.arcade.overlap(player1, cactus, collectCactus, null, this);



    //  Player en estatico
    player.body.velocity.x = 0;
    player1.body.velocity.x = 0;

    if (cursors.left.isDown)
    {
        //  Movemos a la izquierda
        player.body.velocity.x = velocityLeft;
		
		//AÑADIR
		direccion = -1;

        player.animations.play('left');
    }
    else if (cursors.right.isDown)
    {
        //  Movemos a la drecha
        player.body.velocity.x = velocityRight;
		
		//AÑADIR
		direccion = 1;

        player.animations.play('right');
    }
    else
    {
        //  Estatico
        player.animations.stop();
		
		//AÑADIR
		direccion = 0;
		
        player.frame = 4;
    }
    

    if (keyA.isDown)
   {
       //  Movemos a la izquierda
       player1.body.velocity.x = velocityLeft;

       player1.animations.play('left');
   }
   else if (keyD.isDown)
   {
       //  Movemos a la drecha
       player1.body.velocity.x = velocityRight;

       player1.animations.play('right');
   }else
   {
       //  Estatico
       player1.animations.stop();

       player1.frame = 4;
   }


    //  Permitimos el salto
    if (cursors.up.isDown && player.body.touching.down)
    {
        player.body.velocity.y = -350;
    }
	
     if (keyW.isDown && player1.body.touching.down)
   {
     player1.body.velocity.y = -350;
   }

	// Disparar
	if (game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR) && direccion != 0)
    {
        fireBullet();
    }

    if (game.input.keyboard.isDown(Phaser.Keyboard.X)&& direccion != 0)
    {
        fireBullet1();
    }
}

	function destroyBullet(bullet,platforms) {
		bullet.kill();
	}

    function destroyBullet1(bullet1,platforms) {
        bullet1.kill();
    }

	//metodo de disparo
function fireBullet () {

    if (game.time.now > bulletTime)
    {
        bullet = bullets.getFirstExists(false);

        if (bullet)
        {
            bullet.reset(player.x + 6, player.y - 8);
            if (direccion == -1)
                bullet.body.velocity.x = -300;
            else if (direccion == 1)
                bullet.body.velocity.x = 300;
            bulletTime = game.time.now + 150;
        }
    }
}


 function fireBullet1 () {

    if (game.time.now > bulletTime1)
    {
        bullet1 = bullets1.getFirstExists(false);

        if (bullet1)
        {
            bullet1.reset(player1.x + 6, player1.y - 8);
            if (direccion == -1)
                bullet1.body.velocity.x = -300;
            else if (direccion == 1)
                bullet1.body.velocity.x = 300;
            bulletTime1 = game.time.now + 150;
        }
    }
}


 

	
	
	//  Called if the bullet goes out of the screen
function resetBullet (bullet) {

    bullet.kill();

}

function resetBullet1 (bullet1) {

    bullet1.kill();

}

function createObject() {
    var crearObjeto = Math.floor(Math.random()*3);
   
    if(objetoRecogido == false){
    switch(crearObjeto){
    case 0:
    life = objetosRandom.create(game.world.width/2 - 40, game.world.height/2 - 125, 'objetos');
    life.animations.add('hologramaeffect', [10, 11, 12, 13, 14, 15, 16, 17, 18, 19], (Math.random()*20) + 5, true);
    life.animations.play('hologramaeffect');
    life.scale.setTo(2,2);
    break;
    case 1:
    
    pollo = objetosRandom.create(game.world.width/2 - 40, game.world.height/2 - 125, 'objetos');
    pollo.animations.add('hologramaeffect2', [30, 31, 32, 33, 34, 35, 36, 37, 38, 39], (Math.random()*20) + 5, true);
    pollo.animations.play('hologramaeffect2');
    pollo.scale.setTo(2,2);
    break;
    case 2:
    
    cactus = objetosRandom.create(game.world.width/2 - 40, game.world.height/2 - 125, 'objetos');
    cactus.animations.add('hologramaeffect3', [0, 1, 2, 3, 4, 5, 6, 7, 8, 9], (Math.random()*20) + 5, true);
    cactus.animations.play('hologramaeffect3');
    cactus.scale.setTo(2,2);
    break;

    default : break;

}
objetoRecogido = true;
game.physics.arcade.enable(objetosRandom);




}
}


function collectLife (player, life) {
    
    // Removes the star from the screen
    life.kill();

    objetoRecogido = false;

}

/*function createPollo() {

   
    if(pollosRecogido == false){
    pollo = game.add.sprite(game.world.width/2 - 70, game.world.height/2 - 70 , 'pollos');

    

    pollo.body.bounce.y = 0.9;
    pollo.body.gravity.y = 150;
    pollo.body.collideWorldBounds = true;

    pollosRecogido = true;
}*/


function collectPollo (player, pollo) {
    
   
    pollo.kill();

    objetoRecogido = false;
    convertirPollos();
    game.time.events.add(Phaser.Timer.SECOND * 4, vueltaNormalidad, this);

}

function collectCactus (player, cactus) {
    
   
    cactus.kill();
    velocidadMaxima();
    game.time.events.add(Phaser.Timer.SECOND * 4, velocidadNormal, this);
    objetoRecogido = false;

}

function convertirPollos() {


    if (player.key === 'dude' && player1.key === 'dude')
    {
        player.loadTexture('chicken', 0, false);
        player.animations.add('pollos', [0, 1], 10, true);
        player.animations.play('pollos');
        
        player1.loadTexture('chicken', 0, false);
        player1.animations.add('pollos', [0, 1], 10, false);
        player1.animations.play('pollos');

        player.body.bounce.y = 1;
        player.body.gravity.y = 10;
        

        player1.body.bounce.y = 1;
        player1.body.gravity.y = 10;
        
        

    }
}

function vueltaNormalidad() {


    if (player.key === 'chicken' && player1.key === 'chicken')
    {
        player.loadTexture('dude', 0, false);
        player1.loadTexture('dude', 0, false);
        player.animations.add('left', [0, 1, 2, 3], 10, true);
        player.animations.add('right', [5, 6, 7, 8], 10, true);
    
        player1.animations.add('left', [0, 1, 2, 3], 10, true);
        player1.animations.add('right', [5, 6, 7, 8], 10, true);

        player.body.bounce.y = 0.2;
        player.body.gravity.y = 300;
        

        player1.body.bounce.y = 0.2;
        player1.body.gravity.y = 300;
        
        

    }
  
    
}

function velocidadMaxima() {

velocityLeft = -300;
velocityRight = 300;


}

function velocidadNormal(){

velocityLeft = -150;
velocityRight = 150;
}


</script>

</body>
</html>